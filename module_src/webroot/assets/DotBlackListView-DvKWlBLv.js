import{d as uu,C as eu,r as D,h as tu,D as au,t as nu,i as lu,j as ou,e as d,f as R,k as su,E as du,F as cu,G as Eu,m as u,b as s,p as e,n as V,l as a,H as Cu,I as Du,q as iu,s as ru,J as gu,K as Bu,L as mu,g as I,M as fu,u as Au,N as v,O as A,P as yu,Q as vu,R as ku,c as H,S as bu,T as wu,U as J,V as xu,W as _u,X as Lu,Y as q,Z as Tu,$ as Mu,a0 as k,a1 as Su,a2 as K,a3 as Iu,a4 as Ru,a5 as Y,a6 as Z,a7 as $,a8 as x,a9 as Nu,aa as hu,ab as $u,x as Uu}from"./index-7CVUmK9Z.js";const Pu=uu({__name:"DotBlackListAppDrawer",props:{type:{},title:{}},emits:["submit"],setup(W,{expose:N,emit:G}){const l=eu();D(null),D(null);const _=W,b=D(!1),L=tu();au(),nu();const o=lu(()=>({theme:L.isDarkMode?iu:ru})),{message:X,modal:c}=ou(["message","modal"],{configProviderProps:o});let i,g;const T=D({openDrawer:w=>new Promise((r,y)=>{if(_.type==="update"&&!w){y(new Error("更新模式下必须传入初始化参数")),X.error("初始化参数不能为空");return}i=r,g=y,m.value="",b.value=!0}),closeDrawer:()=>{b.value=!1,g("Drawer closed without submission")}}),m=D(""),M=D(""),h=async()=>{if(!m.value){c.create({title:"应用包名不能为空",type:"error",preset:"dialog",content:()=>u("p",null,[e("噫？应用包名不能为空（敲")])});return}if(l.allPackageName.has(m.value)){c.create({title:"应用包名已存在",type:"error",preset:"dialog",content:()=>u("p",null,[e("噫？这个应用包名已经存在列表中了（敲")])});return}f.value=!0;const w=()=>{f.value=!1,b.value=!1},r=()=>{f.value=!1},y={name:m.value,loadingCallback:r,closeCallback:w};c.create({title:"确认隐藏窗口控制器吗？",type:"warning",preset:"dialog",content:()=>u("p",null,[e("窗口控制器的隐藏受小米云控规则下发影响，如果隐藏窗口控制器失效，请重新操作")," ",u("span",{class:`font-bold ${L.isDarkMode?"text-teal-400":"text-gray-600"}`},[e("热重载应用数据")])," ",e("，如后续需要恢复")," ",u("span",{class:`font-bold ${L.isDarkMode?"text-teal-400":"text-gray-600"}`},[e("窗口控制器")])," ",e("的显示，则需要先清除自定义规则，确定要继续吗？")]),positiveText:"确定隐藏",negativeText:"我再想想",onPositiveClick:async()=>{i(y)},onNegativeClick(){r()},onMaskClick(){r()},onClose(){r()}})},f=D(!1);return N({openDrawer:T.value.openDrawer}),(w,r)=>{const y=d("n-input-group-label"),U=d("n-input"),P=d("n-input-group"),O=d("n-alert"),Q=d("n-button"),S=d("n-drawer-content"),z=d("n-drawer");return R(),su(Du,null,[du(w.$slots,"default",cu(Eu({openDrawer:T.value.openDrawer}))),u(z,{show:b.value,"onUpdate:show":r[3]||(r[3]=n=>b.value=n),"default-width":500,placement:"right"},{default:s(()=>[u(S,{"body-content-class":"auto-ui-drawer-content","scrollbar-props":{trigger:"none"},title:_.title,closable:""},{footer:s(()=>[u(Q,{type:"info",loading:f.value,"onUpdate:loading":r[1]||(r[1]=n=>f.value=n),onClick:r[2]||(r[2]=()=>h())},{default:s(()=>r[6]||(r[6]=[e(" 提交 ")])),_:1},8,["loading"])]),default:s(()=>[u(P,{class:V(a(L).MIOSVersion&&a(L).MIOSVersion>=2?"":"mb-5")},{default:s(()=>[u(y,{size:"large"},{default:s(()=>r[4]||(r[4]=[e("应用包名")])),_:1}),u(U,{size:"large",status:M.value,value:m.value,"onUpdate:value":r[0]||(r[0]=n=>m.value=n),"allow-input":n=>Cu(n),readonly:_.type==="update",placeholder:"请输入应用包名"},null,8,["status","value","allow-input","readonly"])]),_:1},8,["class"]),u(O,{"show-icon":!1,bordered:!1,title:"隐藏窗口控制器",type:"info",class:"mt-5"},{default:s(()=>r[5]||(r[5]=[e(" 添加后，应用上方的窗口控制器将被隐藏 ")])),_:1})]),_:1},8,["title"])]),_:1},8,["show"])],64)}}}),Ou={class:"autoui-view mb-10"},Qu={class:"mt-5"},zu={class:"mb-5 px-4 sm:px-0"},Hu={class:"flex flex-wrap"},Ku={class:"flex flex-wrap"},Wu=uu({__name:"DotBlackListView",setup(W){const N=D(null),G=z(),l=tu(),_=gu(),b=lu(()=>({theme:l.isDarkMode?iu:ru})),{message:L,modal:o,notification:X}=ou(["message","modal","notification"],{configProviderProps:b}),c=au(),i=eu(),g=D(!1),T=D(!1);Bu();const m=D(null);fu(),nu(),Au();const M=D("");function h(n){return()=>K(A,null,{default:()=>K(n)})}const f=async()=>{if(!l.ABTestInfo.Hyper_OS_DOT_BLACK_LIST_MANAGER){o.create({title:"内测说明",type:"warning",preset:"dialog",content:()=>u("p",null,[e("该功能尚处于内部开发阶段，未完工，请期待后续消息！")])});return}if(!i.systemDotBlackList.length){o.create({title:"获取云控失败",type:"error",preset:"dialog",content:()=>u("p",null,[e("无法获取到HTML查看器的云控，请检查是否禁用云控或者清除HTML查看器的数据再重启平板尝试操作~")])});return}await l.getAndroidApplicationPackageNameList(),await c.initDefault()},w=async()=>{const[n,t]=await k(_.getList());n&&o.create({title:"获取失败",type:"error",preset:"dialog",content:()=>u("p",null,[e("获取已安装应用名称发生错误，详细错误请查看日志列表~")]),negativeText:"确定"}),t&&o.create({title:"获取成功",type:"success",preset:"dialog",content:()=>u("p",null,[e("好耶OwO，已重新获取当前已安装的应用名称~")]),negativeText:"确定"})},r=()=>{i.filterInstalledApps=!i.filterInstalledApps},y=async()=>{if(!l.ABTestInfo.Hyper_OS_DOT_BLACK_LIST_MANAGER){o.create({title:"内测说明",type:"warning",preset:"dialog",content:()=>u("p",null,[e("该功能尚处于内部开发阶段，未完工，请期待后续消息！")])});return}if(!i.systemDotBlackList.length){o.create({title:"获取云控失败",type:"error",preset:"dialog",content:()=>u("p",null,[e("无法获取到HTML查看器的云控，请检查是否禁用云控或者清除HTML查看器的数据再重启平板尝试操作~")])});return}T.value=!0,await f();const[n,t]=await k(Su());n&&(o.create({title:"热重载应用数据失败",type:"error",preset:"dialog",content:()=>u("p",null,[e("热重载应用数据失败了QwQ，详情请查看错误日志~")]),negativeText:"确定"}),T.value=!1),t&&(o.create({title:"热重载应用数据成功",type:"success",preset:"dialog",content:()=>u("p",null,[e("好耶w，已经重新为你载入包括自定义规则在内的应用数据~")]),positiveText:"确定"}),T.value=!1)},U=async()=>{if(!l.ABTestInfo.Hyper_OS_DOT_BLACK_LIST_MANAGER){o.create({title:"内测说明",type:"warning",preset:"dialog",content:()=>u("p",null,[e("该功能尚处于内部开发阶段，未完工，请期待后续消息！")])});return}if(!i.systemDotBlackList.length){o.create({title:"获取云控失败",type:"error",preset:"dialog",content:()=>u("p",null,[e("无法获取到HTML查看器的云控，请检查是否禁用云控或者清除HTML查看器的数据再重启平板尝试操作~")])});return}M.value="";const[,n]=await k(new Promise((t,F)=>{o.create({title:"请粘贴分享口令",preset:"dialog",style:"min-width:500px; width:50%;",content:()=>K(q,{type:"textarea",value:M.value,"onUpdate:value":C=>{M.value=C},autosize:{minRows:8,maxRows:8},placeholder:"在此处粘贴分享规则口令"}),positiveText:"确定提交",negativeText:"取消导入",onPositiveClick(){t("positiveClick")}})}));if(n){g.value=!0;const t=M.value,F=Iu(t);if(!(F!=null&&F.length)){o.create({title:"导入分享规则失败",type:"error",preset:"dialog",content:()=>u("p",null,[e("导入分享规则失败了QwQ，解析")," ",u("span",{class:`font-bold ${l.isDarkMode?"text-teal-400":"text-gray-600"}`},[e("自定义规则")])," ",e("口令发生错误，无法正常解析。")]),negativeText:"确定"}),g.value=!1;return}console.log(F,"getBase64String");try{const C=Ru(F),E=Y.inflate(C,{to:"string"}),p=JSON.parse(E);if(p.type!=="autoui"){o.create({title:"导入分享规则失败",type:"error",preset:"dialog",content:()=>u("p",null,[e("导入分享规则失败了QwQ，该")," ",u("span",{class:`font-bold ${l.isDarkMode?"text-teal-400":"text-gray-600"}`},[e("自定义规则")])," ",e("不适用于应用布局优化。")]),negativeText:"确定"}),g.value=!1;return}if(p.device==="pad"&&l.deviceCharacteristics!=="tablet"||p.device==="fold"&&l.deviceCharacteristics==="tablet"){o.create({title:"导入分享规则失败",type:"error",preset:"dialog",content:()=>u("p",null,[e("导入分享规则失败了QwQ，平板和折叠屏的适配规则不能混用哦~")]),negativeText:"确定"}),g.value=!1;return}c.customConfigAutoUIList[p.name]=p.rules,c.autoUISettingConfig[p.name]={name:p.name,enable:!0};const[B,j]=await k(Z({customAutoUIListXML:$(c.customConfigAutoUIList,"package",void 0),settingConfigXML:$(c.autoUISettingConfig,"setting","setting_config"),reloadRuleAction:{name:p.name,action:"enable"}}));B?(o.create({title:"导入分享规则失败",type:"error",preset:"dialog",content:()=>u("p",null,[e("发生异常错误，导入失败了QwQ，该功能尚在测试阶段，尚不稳定，出现异常请及时反馈~")])}),g.value=!1):(c.updateMergeRuleList(),await f(),g.value=!1,o.create({title:"导入分享规则成功",type:"success",preset:"dialog",content:()=>u("p",null,[e("好耶w，")," ",u("span",{class:`font-bold ${l.isDarkMode?"text-teal-400":"text-gray-600"}`},[x(p.name,l.installedAppNameList[p.name]||c.applicationName[p.name])])," ",e("的应用配置成功了OwO~如果应用更新后的规则不生效，可以尝试重启平板再做尝试~")]),positiveText:"确定"}))}catch(C){console.log(C,"error"),o.create({title:"导入分享规则失败",type:"error",preset:"dialog",content:()=>u("p",null,[e("解析分享规则失败了QwQ，请检查导入口令是否有误")]),negativeText:"确定"}),g.value=!1}}},P=async(n,t,F,C)=>{if(!l.ABTestInfo.Hyper_OS_DOT_BLACK_LIST_MANAGER){o.create({title:"内测说明",type:"warning",preset:"dialog",content:()=>u("p",null,[e("该功能尚处于内部开发阶段，未完工，请期待后续消息！")])});return}if(!i.systemDotBlackList.length){o.create({title:"获取云控失败",type:"error",preset:"dialog",content:()=>u("p",null,[e("无法获取到HTML查看器的云控，请检查是否禁用云控或者清除HTML查看器的数据再重启平板尝试操作~")])});return}if(n==="cleanCustomRule"){const E=o.create({title:"想清除自定义规则吗？",type:"warning",preset:"dialog",content:()=>u("p",null,[e("清除自定义规则后，将恢复")," ",u("span",{class:`font-bold ${l.isDarkMode?"text-teal-400":"text-gray-600"}`},[x(F.name,F.applicationName)])," ",e("的窗口控制器显示效果。确定要继续吗？")]),positiveText:"确定清除",negativeText:"我再想想",onPositiveClick:async()=>{E.loading=!0;const[p,B]=await k(Z({customAutoUIListXML:$(c.customConfigAutoUIList,"package",void 0),settingConfigXML:$(c.autoUISettingConfig,"setting","setting_config")}));p?(o.create({title:"清除自定义规则失败",type:"error",preset:"dialog",content:()=>u("p",null,[e("发生异常错误，更新失败了QwQ，该功能尚在测试阶段，尚不稳定，出现异常请及时反馈~")])}),E.loading=!1):(o.create({title:"清除自定义规则成功",type:"success",preset:"dialog",content:()=>u("p",null,[e("好耶w，清除自定义规则成功了OwO~如果应用更新后的规则不生效，可以尝试重启平板再试试~")])}),E.loading=!1,c.updateMergeRuleList())}})}if(n==="shareCustomRule"){const E={name:F.name,cmpt:1,rules:{name:F.name},type:"dot_black_list",device:l.deviceCharacteristics==="tablet"?"pad":"fold"};console.log(E,"shareContent");const p=JSON.stringify(E),B=Y.deflate(p,{level:9,memLevel:9,windowBits:15}),j=new Uint8Array(B),Fu=$u(j),[pu]=await k(navigator.clipboard.writeText(`我分享了一个[应用布局优化]的自定义规则，可以前往[完美横屏应用计划 For Web UI]导入：
${Fu}`));if(pu){o.create({title:"复制分享口令失败",type:"error",preset:"dialog",content:()=>u("p",null,[e("复制")," ",u("span",{class:`font-bold ${l.isDarkMode?"text-teal-400":"text-gray-600"}`},[x(F.name,F.applicationName)])," ",e("的分享口令失败了QwQ，可能由于没有读取/写入剪切板的权限或")," ",u("span",{class:`font-bold ${l.isDarkMode?"text-teal-400":"text-gray-600"}`},[e("自定义规则")])," ",e("长度过大。")]),negativeText:"确定"});return}else o.create({title:"复制分享口令成功",type:"success",preset:"dialog",content:()=>u("div",null,[u("p",null,[e("好耶w，复制")," ",u("span",{class:`font-bold ${l.isDarkMode?"text-teal-400":"text-gray-600"}`},[x(F.name,F.applicationName)])," ",e("分享口令成功了~")]),u("p",null,[e("如果没有复制成功，请确认是否给予了读取/写入剪切板的权限或")," ",u("span",{class:`font-bold ${l.isDarkMode?"text-teal-400":"text-gray-600"}`},[e("自定义规则")])," ",e("长度过大。")]),u("p",null,[e("分享口令导入入口位于")," ",u("span",{class:`font-bold ${l.isDarkMode?"text-teal-400":"text-gray-600"}`},[e("应用布局优化- 从分享口令导入")])," ",e("。")])]),positiveText:"确定"})}},O=(n,t)=>{o.create({title:"系统规则说明",type:"warning",preset:"dialog",content:()=>u("p",null,[e("系统已对")," ",u("span",{class:`font-bold ${l.isDarkMode?"text-teal-400":"text-gray-600"}`},[x(n.name,n.applicationName)])," ",e("配置了窗口控制器的隐藏，且不可被移除，仅有自定义规则可以被移除哦~")])})},Q=async()=>{if(!l.ABTestInfo.Hyper_OS_DOT_BLACK_LIST_MANAGER){o.create({title:"内测说明",type:"warning",preset:"dialog",content:()=>u("p",null,[e("该功能尚处于内部开发阶段，未完工，请期待后续消息！")])});return}if(!i.systemDotBlackList.length){o.create({title:"获取云控失败",type:"error",preset:"dialog",content:()=>u("p",null,[e("无法获取到HTML查看器的云控，请检查是否禁用云控或者清除HTML查看器的数据再重启平板尝试操作~")])});return}if(m.value){const[n,t]=await k(m.value.openDrawer());if(n)console.log("操作取消:",n);else{i.customDotBlackList.push(t.name);const F=i.mergeDotBlackList.map(p=>p.name);console.log(F,"ttt");const[C,E]=await k(Nu({dotBlackList:F,sourceDotBlackList:i.sourceDotBlackList,customDotBlackList:i.customDotBlackList}));C?(o.create({title:"应用添加失败",type:"error",preset:"dialog",content:()=>u("p",null,[e("发生异常错误，添加失败了QwQ，该功能尚在测试阶段，尚不稳定，出现异常请及时反馈~")])}),t.loadingCallback&&t.loadingCallback()):(o.create({title:"应用添加成功",type:"success",preset:"dialog",content:()=>u("p",null,[e("好耶w，已经成功配置")," ",u("span",{class:`font-bold ${l.isDarkMode?"text-teal-400":"text-gray-600"}`},[x(t.name,l.installedAppNameList[t.name]||i.applicationName[t.name])])," ",e("的窗口控制器隐藏效果了OwO~实际生效还需要重启")," ",u("span",{class:`font-bold ${l.isDarkMode?"text-teal-400":"text-gray-600"}`},[e("系统界面")])," ",e("的作用域，确定要继续吗？")]),positiveText:"确定重启作用域",negativeText:"稍后手动重启",onPositiveClick(){hu().then(p=>{o.create({title:"重启作用域成功",type:"success",preset:"dialog",content:()=>u("p",null,[e("已经成功为你重启系统界面的作用域，请手动结束")," ",u("span",{class:`font-bold ${l.isDarkMode?"text-teal-400":"text-gray-600"}`},[x(t.name,l.installedAppNameList[t.name]||i.applicationName[t.name])])," ",e("的运行，再查看是否生效~")])})}).catch(p=>{o.create({title:"重启作用域失败",type:"error",preset:"dialog",content:()=>u("p",null,[e("发生异常错误，重启系统界面作用域失败QwQ，详细错误请查看日志~")])})})}}),i.initDefault(),t.loadingCallback&&t.loadingCallback(),t.closeCallback&&t.closeCallback())}}},S=mu({page:1,pageSize:10,showSizePicker:!0,onChange:n=>{S.page=n},onUpdatePageSize:n=>{S.pageSize=n,S.page=1}});function z(){return[{title:"应用名称",minWidth:250,key:"name",render(n,t){return u("div",null,[n.applicationName&&u("p",null,[n.applicationName]),n.name&&u("p",null,[u("span",{class:{hidden:!n.applicationName}},[e("(")]),n.name,u("span",{class:{hidden:!n.applicationName}},[e(")")])])])}},{title:"规则状态",width:150,key:"isOptimizeWebView",render(n,t){return n.status?u(d("n-tag"),{bordered:!1,dashed:!0,type:"success"},{default:()=>[e("已生效")]}):u(d("n-tag"),{bordered:!1,dashed:!0,type:"info"},{default:()=>[e("未生效")]})}},{title:"规则来源",width:150,key:"ruleMode",render(n,t){if(n.ruleMode==="custom"){const F=[{label:"分享自定义规则",key:"shareCustomRule",icon:h(J)},{label:"清除自定义规则",key:"cleanCustomRule",icon:h(Uu)}];return u(d("n-dropdown"),{onSelect:(C,E)=>P(C,E,n),size:"large",trigger:"click",options:F},{default:()=>[u(d("n-button"),{size:"small",dashed:!0,type:"info"},{default:()=>[e("自定义规则")]})]})}return u(d("n-button"),{size:"small",dashed:!0,type:"error",onClick:()=>O(n)},{default:()=>[e("系统规则")]})}}]}return(n,t)=>{const F=d("n-watermark"),C=d("n-input-group"),E=d("n-card"),p=d("n-data-table");return R(),su("main",Ou,[u(F,{content:"未开放，请等待后续消息",cross:"",fullscreen:"","font-size":16,"line-height":16,width:384,height:384,"z-index":9999,"x-offset":12,"y-offset":60,rotate:-15}),I("div",Qu,[I("div",zu,[I("h3",{class:V(`text-base font-semibold leading-7 ${a(l).isDarkMode?"text-white":"text-gray-900"}`)}," 窗口控制器 ",2),I("p",{class:V(`mt-1 max-w-2xl text-sm leading-6 ${a(l).isDarkMode?"text-gray-300":"text-gray-500"}`)}," 在这里可以快速管理有关窗口控制器的配置 ",2)])]),u(E,{title:"操作区",size:"small"},{default:s(()=>[I("div",Hu,[u(a(v),{class:"mb-3 mr-3",type:"info",loading:a(l).loading||a(i).loading,onClick:Q},{icon:s(()=>[u(a(A),null,{default:s(()=>[u(a(yu))]),_:1})]),default:s(()=>[t[7]||(t[7]=e(" 添加应用 "))]),_:1},8,["loading"]),u(a(v),{class:"mb-3 mr-3",type:"success",loading:a(l).loading||a(i).loading,onClick:t[0]||(t[0]=()=>f())},{icon:s(()=>[u(a(A),null,{default:s(()=>[u(a(vu))]),_:1})]),default:s(()=>[t[8]||(t[8]=e(" 刷新应用列表 "))]),_:1},8,["loading"]),u(a(v),{class:"mb-3 mr-3",color:"#8a2be2",loading:a(l).loading||a(i).loading,onClick:t[1]||(t[1]=()=>y())},{icon:s(()=>[u(a(A),null,{default:s(()=>[u(a(ku))]),_:1})]),default:s(()=>[t[9]||(t[9]=e(" 热重载应用数据 "))]),_:1},8,["loading"]),a(l).androidTargetSdk&&a(l).androidTargetSdk>33?(R(),H(a(v),{key:0,class:"mb-3 mr-3",color:"#69b2b6",loading:a(l).loading||a(i).loading||a(_).loading.value,onClick:t[2]||(t[2]=B=>w())},{icon:s(()=>[u(a(A),null,{default:s(()=>[u(a(bu))]),_:1})]),default:s(()=>[t[10]||(t[10]=e(" 获取已安装应用名称 "))]),_:1},8,["loading"])):wu("",!0),u(a(v),{class:"mb-3 mr-3",type:"warning",loading:a(l).loading||a(i).loading||g.value,onClick:t[3]||(t[3]=B=>U())},{icon:s(()=>[u(a(A),null,{default:s(()=>[u(a(J))]),_:1})]),default:s(()=>[t[11]||(t[11]=e(" 从分享口令导入 "))]),_:1},8,["loading"])]),I("div",Ku,[u(a(v),{class:"mb-3 mr-3",type:a(i).filterInstalledApps?"warning":"info",strong:"",loading:a(l).loading||a(i).loading,secondary:"",onClick:r},{icon:s(()=>[u(a(A),null,{default:s(()=>[a(i).filterInstalledApps?(R(),H(a(xu),{key:0})):(R(),H(a(_u),{key:1}))]),_:1})]),default:s(()=>[e(" "+Lu(a(i).filterInstalledApps?"已安装应用":"全部应用"),1)]),_:1},8,["type","loading"])]),u(C,null,{default:s(()=>[u(a(q),{size:"large",clearable:"",value:a(i).searchKeyWord,"onUpdate:value":t[4]||(t[4]=B=>a(i).searchKeyWord=B),ref_key:"searchKeyWordInput",ref:N,placeholder:"搜索应用名称/应用包名",autosize:"",style:{width:"80%"}},null,8,["value"]),u(a(v),{size:"large",type:"primary",onClick:t[5]||(t[5]=()=>{var B;(B=N.value)==null||B.blur()})},{icon:s(()=>[u(a(A),null,{default:s(()=>[u(a(Tu))]),_:1})]),default:s(()=>[t[12]||(t[12]=e(" 搜索 "))]),_:1}),u(a(v),{size:"large",bordered:"",onClick:t[6]||(t[6]=()=>{a(c).searchKeyWord=""})},{icon:s(()=>[u(a(A),null,{default:s(()=>[u(a(Mu))]),_:1})]),default:s(()=>[t[13]||(t[13]=e(" 清空 "))]),_:1})]),_:1})]),_:1}),u(p,{loading:a(l).loading||a(i).loading,columns:a(G),data:a(i).filterMergeDotBlackList,pagination:S},null,8,["loading","columns","data","pagination"]),u(Pu,{ref_key:"addDotBlackListApp",ref:m,type:"add",title:"添加应用"},null,512)])}}});export{Wu as default};
