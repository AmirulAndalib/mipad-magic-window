import{d as eu,r as m,h as tu,B as au,i as nu,j as lu,C as ou,D as iu,E as su,t as ru,F as du,k as Fu,m as u,g as A,n as U,l as a,b as o,G as pu,u as cu,e as C,f as I,H as f,N as g,I as Eu,p as t,J as Cu,K as gu,L as Du,M as $,c as N,O as fu,P as Bu,Q as mu,R as O,S as Au,T as yu,U as P,q as vu,s as xu,V as B,W as bu,X as L,Y as ku,Z as _u,$ as z,a0 as T,a1 as y,a2 as v,a3 as wu,x as Iu}from"./index-CY9NzEwo.js";const Lu={class:"autoui-view mb-10"},Tu={class:"mt-5"},Su={class:"mb-5 px-4 sm:px-0"},Mu={class:"flex flex-wrap"},hu={class:"flex flex-wrap"},Ou=eu({__name:"DotBlackListView",setup(Ru){const S=m(null),Q=Y(),l=tu(),M=au(),K=nu(()=>({theme:l.isDarkMode?vu:xu})),{message:Uu,modal:i,notification:$u}=lu(["message","modal","notification"],{configProviderProps:K}),r=ou(),F=iu(),D=m(!1),k=m(!1);su();const _=m(null),W=m(null);pu(),ru(),cu();const x=m("");function h(n){return()=>L(g,null,{default:()=>L(n)})}const w=async()=>{if(!l.ABTestInfo.Hyper_OS_DOT_BLACK_LIST_MANAGER){i.create({title:"内测说明",type:"warning",preset:"dialog",content:()=>u("p",null,[t("该功能尚处于内部开发阶段，未完工，请期待后续消息！")])});return}await l.getAndroidApplicationPackageNameList(),await r.initDefault()},V=async()=>{const[n,e]=await B(M.getList());n&&i.create({title:"获取失败",type:"error",preset:"dialog",content:()=>u("p",null,[t("获取已安装应用名称发生错误，详细错误请查看日志列表~")]),negativeText:"确定"}),e&&i.create({title:"获取成功",type:"success",preset:"dialog",content:()=>u("p",null,[t("好耶OwO，已重新获取当前已安装的应用名称~")]),negativeText:"确定"})},X=()=>{F.filterInstalledApps=!F.filterInstalledApps},H=async()=>{if(!l.ABTestInfo.Hyper_OS_DOT_BLACK_LIST_MANAGER){i.create({title:"内测说明",type:"warning",preset:"dialog",content:()=>u("p",null,[t("该功能尚处于内部开发阶段，未完工，请期待后续消息！")])});return}k.value=!0,await w();const[n,e]=await B(bu());n&&(i.create({title:"热重载应用数据失败",type:"error",preset:"dialog",content:()=>u("p",null,[t("热重载应用数据失败了QwQ，详情请查看错误日志~")]),negativeText:"确定"}),k.value=!1),e&&(i.create({title:"热重载应用数据成功",type:"success",preset:"dialog",content:()=>u("p",null,[t("好耶w，已经重新为你载入包括自定义规则在内的应用数据~")]),positiveText:"确定"}),k.value=!1)},G=async()=>{if(!l.ABTestInfo.Hyper_OS_DOT_BLACK_LIST_MANAGER){i.create({title:"内测说明",type:"warning",preset:"dialog",content:()=>u("p",null,[t("该功能尚处于内部开发阶段，未完工，请期待后续消息！")])});return}x.value="";const[,n]=await B(new Promise((e,s)=>{i.create({title:"请粘贴分享口令",preset:"dialog",style:"min-width:500px; width:50%;",content:()=>L(O,{type:"textarea",value:x.value,"onUpdate:value":c=>{x.value=c},autosize:{minRows:8,maxRows:8},placeholder:"在此处粘贴分享规则口令"}),positiveText:"确定提交",negativeText:"取消导入",onPositiveClick(){e("positiveClick")}})}));if(n){D.value=!0;const e=x.value,s=ku(e);if(!(s!=null&&s.length)){i.create({title:"导入分享规则失败",type:"error",preset:"dialog",content:()=>u("p",null,[t("导入分享规则失败了QwQ，解析")," ",u("span",{class:`font-bold ${l.isDarkMode?"text-teal-400":"text-gray-600"}`},[t("自定义规则")])," ",t("口令发生错误，无法正常解析。")]),negativeText:"确定"}),D.value=!1;return}console.log(s,"getBase64String");try{const c=_u(s),p=z.inflate(c,{to:"string"}),d=JSON.parse(p);if(d.type!=="autoui"){i.create({title:"导入分享规则失败",type:"error",preset:"dialog",content:()=>u("p",null,[t("导入分享规则失败了QwQ，该")," ",u("span",{class:`font-bold ${l.isDarkMode?"text-teal-400":"text-gray-600"}`},[t("自定义规则")])," ",t("不适用于应用布局优化。")]),negativeText:"确定"}),D.value=!1;return}if(d.device==="pad"&&l.deviceCharacteristics!=="tablet"||d.device==="fold"&&l.deviceCharacteristics==="tablet"){i.create({title:"导入分享规则失败",type:"error",preset:"dialog",content:()=>u("p",null,[t("导入分享规则失败了QwQ，平板和折叠屏的适配规则不能混用哦~")]),negativeText:"确定"}),D.value=!1;return}r.customConfigAutoUIList[d.name]=d.rules,r.autoUISettingConfig[d.name]={name:d.name,enable:!0};const[E,R]=await B(T({customAutoUIListXML:y(r.customConfigAutoUIList,"package",void 0),settingConfigXML:y(r.autoUISettingConfig,"setting","setting_config"),reloadRuleAction:{name:d.name,action:"enable"}}));E?(i.create({title:"导入分享规则失败",type:"error",preset:"dialog",content:()=>u("p",null,[t("发生异常错误，导入失败了QwQ，该功能尚在测试阶段，尚不稳定，出现异常请及时反馈~")])}),D.value=!1):(r.updateMergeRuleList(),await w(),D.value=!1,i.create({title:"导入分享规则成功",type:"success",preset:"dialog",content:()=>u("p",null,[t("好耶w，")," ",u("span",{class:`font-bold ${l.isDarkMode?"text-teal-400":"text-gray-600"}`},[v(d.name,r.applicationName[d.name])])," ",t("的应用配置成功了OwO~如果应用更新后的规则不生效，可以尝试重启平板再做尝试~")]),positiveText:"确定"}))}catch(c){console.log(c,"error"),i.create({title:"导入分享规则失败",type:"error",preset:"dialog",content:()=>u("p",null,[t("解析分享规则失败了QwQ，请检查导入口令是否有误")]),negativeText:"确定"}),D.value=!1}}},j=async(n,e,s,c)=>{if(!l.ABTestInfo.Hyper_OS_DOT_BLACK_LIST_MANAGER){i.create({title:"内测说明",type:"warning",preset:"dialog",content:()=>u("p",null,[t("该功能尚处于内部开发阶段，未完工，请期待后续消息！")])});return}if(n==="cleanCustomRule"){const p=i.create({title:"想清除自定义规则吗？",type:"warning",preset:"dialog",content:()=>u("p",null,[t("清除自定义规则后，你对")," ",u("span",{class:`font-bold ${l.isDarkMode?"text-teal-400":"text-gray-600"}`},[v(s.name,s.applicationName)])," ",t("所做的所有自定义配置将丢失，如果该应用同时还存在")," ",u("span",{class:`font-bold ${l.isDarkMode?"text-teal-400":"text-gray-600"}`},[t("模块规则")])," ",t("，将会还原回模块自身的适配规则。确定要继续吗？")]),positiveText:"确定清除",negativeText:"我再想想",onPositiveClick:async()=>{p.loading=!0,r.customConfigAutoUIList[s.name]&&delete r.customConfigAutoUIList[s.name];const[d,E]=await B(T({customAutoUIListXML:y(r.customConfigAutoUIList,"package",void 0),settingConfigXML:y(r.autoUISettingConfig,"setting","setting_config")}));d?(i.create({title:"清除自定义规则失败",type:"error",preset:"dialog",content:()=>u("p",null,[t("发生异常错误，更新失败了QwQ，该功能尚在测试阶段，尚不稳定，出现异常请及时反馈~")])}),p.loading=!1):(i.create({title:"清除自定义规则成功",type:"success",preset:"dialog",content:()=>u("p",null,[t("好耶w，清除自定义规则成功了OwO~如果应用更新后的规则不生效，可以尝试重启平板再试试~")])}),p.loading=!1,r.updateMergeRuleList())}})}if(n==="shareCustomRule"){const p={name:s.name,cmpt:1,rules:{name:s.name},type:"dot_black_list",device:l.deviceCharacteristics==="tablet"?"pad":"fold"};console.log(p,"shareContent");const d=JSON.stringify(p),E=z.deflate(d,{level:9,memLevel:9,windowBits:15}),R=new Uint8Array(E),Z=wu(R),[uu]=await B(navigator.clipboard.writeText(`我分享了一个[应用布局优化]的自定义规则，可以前往[完美横屏应用计划 For Web UI]导入：
${Z}`));if(uu){i.create({title:"复制分享口令失败",type:"error",preset:"dialog",content:()=>u("p",null,[t("复制")," ",u("span",{class:`font-bold ${l.isDarkMode?"text-teal-400":"text-gray-600"}`},[v(s.name,s.applicationName)])," ",t("的分享口令失败了QwQ，可能由于没有读取/写入剪切板的权限或")," ",u("span",{class:`font-bold ${l.isDarkMode?"text-teal-400":"text-gray-600"}`},[t("自定义规则")])," ",t("长度过大。")]),negativeText:"确定"});return}else i.create({title:"复制分享口令成功",type:"success",preset:"dialog",content:()=>u("div",null,[u("p",null,[t("好耶w，复制")," ",u("span",{class:`font-bold ${l.isDarkMode?"text-teal-400":"text-gray-600"}`},[v(s.name,s.applicationName)])," ",t("分享口令成功了~")]),u("p",null,[t("如果没有复制成功，请确认是否给予了读取/写入剪切板的权限或")," ",u("span",{class:`font-bold ${l.isDarkMode?"text-teal-400":"text-gray-600"}`},[t("自定义规则")])," ",t("长度过大。")]),u("p",null,[t("分享口令导入入口位于")," ",u("span",{class:`font-bold ${l.isDarkMode?"text-teal-400":"text-gray-600"}`},[t("应用布局优化- 从分享口令导入")])," ",t("。")])]),positiveText:"确定"})}},J=(n,e)=>{i.create({title:"系统规则说明",type:"warning",preset:"dialog",content:()=>u("p",null,[t("系统已对")," ",u("span",{class:`font-bold ${l.isDarkMode?"text-teal-400":"text-gray-600"}`},[v(n.name,n.applicationName)])," ",t("配置了窗口控制器的隐藏，且不可被移除，仅有自定义规则可以被移除哦~")])})},q=async()=>{if(!l.ABTestInfo.Hyper_OS_DOT_BLACK_LIST_MANAGER){i.create({title:"内测说明",type:"warning",preset:"dialog",content:()=>u("p",null,[t("该功能尚处于内部开发阶段，未完工，请期待后续消息！")])});return}if(_.value){const[n,e]=await B(_.value.openDrawer());if(n)console.log("操作取消:",n);else{r.customConfigAutoUIList[e.name]={name:e.name,enable:!0,...e!=null&&e.modePayload.skippedAppConfigChange?{skippedAppConfigChange:!0}:{},...e!=null&&e.modePayload.optimizeWebView?{optimizeWebView:!0}:{},...e!=null&&e.modePayload.hasOwnProperty("activityRule")?{activityRule:e==null?void 0:e.modePayload.activityRule}:{},...e!=null&&e.modePayload.hasOwnProperty("skippedActivityRule")?{skippedActivityRule:e==null?void 0:e.modePayload.skippedActivityRule}:{}},r.autoUISettingConfig[e.name]={name:e.name,enable:!0};const[s,c]=await B(T({customAutoUIListXML:y(r.customConfigAutoUIList,"package",void 0),settingConfigXML:y(r.autoUISettingConfig,"setting","setting_config"),reloadRuleAction:{name:e.name,action:"enable"}}));s?(i.create({title:"应用添加失败",type:"error",preset:"dialog",content:()=>u("p",null,[t("发生异常错误，添加失败了QwQ，该功能尚在测试阶段，尚不稳定，出现异常请及时反馈~")])}),e.loadingCallback&&e.loadingCallback()):(i.create({title:"应用添加成功",type:"success",preset:"dialog",content:()=>u("p",null,[t("好耶w，")," ",u("span",{class:`font-bold ${l.isDarkMode?"text-teal-400":"text-gray-600"}`},[v(e.name,r.applicationName[e.name])])," ",t("的应用配置添加成功了OwO~应用布局优化仅在应用全屏场景下生效，如果应用添加后的规则不生效，可以尝试重启平再做尝试~")])}),r.updateMergeRuleList(),e.loadingCallback&&e.loadingCallback(),e.closeCallback&&e.closeCallback())}}},b=du({page:1,pageSize:10,showSizePicker:!0,onChange:n=>{b.page=n},onUpdatePageSize:n=>{b.pageSize=n,b.page=1}});function Y(){return[{title:"应用名称",minWidth:250,key:"name",render(n,e){return u("div",null,[n.applicationName&&u("p",null,[n.applicationName]),n.name&&u("p",null,[u("span",{class:{hidden:!n.applicationName}},[t("(")]),n.name,u("span",{class:{hidden:!n.applicationName}},[t(")")])])])}},{title:"规则状态",width:150,key:"isOptimizeWebView",render(n,e){return n.status?u(C("n-tag"),{bordered:!1,dashed:!0,type:"success"},{default:()=>[t("已生效")]}):u(C("n-tag"),{bordered:!1,dashed:!0,type:"info"},{default:()=>[t("未生效")]})}},{title:"规则来源",width:150,key:"ruleMode",render(n,e){if(n.ruleMode==="custom"){const s=[{label:"分享自定义规则",key:"shareCustomRule",icon:h($)},{label:"清除自定义规则",key:"cleanCustomRule",icon:h(Iu)}];return u(C("n-dropdown"),{onSelect:(c,p)=>j(c,p,n),size:"large",trigger:"click",options:s},{default:()=>[u(C("n-button"),{size:"small",dashed:!0,type:"info"},{default:()=>[t("自定义规则")]})]})}return u(C("n-button"),{size:"small",dashed:!0,type:"error",onClick:()=>J(n)},{default:()=>[t("系统规则")]})}}]}return(n,e)=>{const s=C("n-watermark"),c=C("n-input-group"),p=C("n-card"),d=C("n-data-table");return I(),Fu("main",Lu,[u(s,{content:"未开放，请等待后续消息",cross:"",fullscreen:"","font-size":16,"line-height":16,width:384,height:384,"z-index":9999,"x-offset":12,"y-offset":60,rotate:-15}),A("div",Tu,[A("div",Su,[A("h3",{class:U(`text-base font-semibold leading-7 ${a(l).isDarkMode?"text-white":"text-gray-900"}`)}," 窗口控制器 ",2),A("p",{class:U(`mt-1 max-w-2xl text-sm leading-6 ${a(l).isDarkMode?"text-gray-300":"text-gray-500"}`)}," 在这里可以快速管理有关窗口控制器的配置 ",2)])]),u(p,{title:"操作区",size:"small"},{default:o(()=>[A("div",Mu,[u(a(f),{class:"mr-3 mb-3",type:"info",loading:a(l).loading||a(F).loading,onClick:q},{icon:o(()=>[u(a(g),null,{default:o(()=>[u(a(Eu))]),_:1})]),default:o(()=>[e[7]||(e[7]=t(" 添加应用 "))]),_:1},8,["loading"]),u(a(f),{class:"mr-3 mb-3",type:"success",loading:a(l).loading||a(F).loading,onClick:e[0]||(e[0]=()=>w())},{icon:o(()=>[u(a(g),null,{default:o(()=>[u(a(Cu))]),_:1})]),default:o(()=>[e[8]||(e[8]=t(" 刷新应用列表 "))]),_:1},8,["loading"]),u(a(f),{class:"mr-3 mb-3",color:"#8a2be2",loading:a(l).loading||a(F).loading,onClick:e[1]||(e[1]=()=>H())},{icon:o(()=>[u(a(g),null,{default:o(()=>[u(a(gu))]),_:1})]),default:o(()=>[e[9]||(e[9]=t(" 热重载应用数据 "))]),_:1},8,["loading"]),u(a(f),{class:"mb-3 mr-3",color:"#69b2b6",loading:a(l).loading||a(F).loading||a(M).loading.value,onClick:e[2]||(e[2]=E=>V())},{icon:o(()=>[u(a(g),null,{default:o(()=>[u(a(Du))]),_:1})]),default:o(()=>[e[10]||(e[10]=t(" 获取已安装应用名称 "))]),_:1},8,["loading"]),u(a(f),{class:"mr-3 mb-3",type:"warning",loading:a(l).loading||a(F).loading||D.value,onClick:e[3]||(e[3]=E=>G())},{icon:o(()=>[u(a(g),null,{default:o(()=>[u(a($))]),_:1})]),default:o(()=>[e[11]||(e[11]=t(" 从分享口令导入 "))]),_:1},8,["loading"])]),A("div",hu,[u(a(f),{class:"mb-3 mr-3",type:a(F).filterInstalledApps?"warning":"info",strong:"",loading:a(l).loading||a(F).loading,secondary:"",onClick:X},{icon:o(()=>[u(a(g),null,{default:o(()=>[a(F).filterInstalledApps?(I(),N(a(fu),{key:0})):(I(),N(a(Bu),{key:1}))]),_:1})]),default:o(()=>[t(" "+mu(a(F).filterInstalledApps?"已安装应用":"全部应用"),1)]),_:1},8,["type","loading"])]),u(c,null,{default:o(()=>[u(a(O),{size:"large",clearable:"",value:a(F).searchKeyWord,"onUpdate:value":e[4]||(e[4]=E=>a(F).searchKeyWord=E),ref_key:"searchKeyWordInput",ref:S,placeholder:"搜索应用名称/应用包名",autosize:"",style:{width:"80%"}},null,8,["value"]),u(a(f),{size:"large",type:"primary",onClick:e[5]||(e[5]=()=>{var E;(E=S.value)==null||E.blur()})},{icon:o(()=>[u(a(g),null,{default:o(()=>[u(a(Au))]),_:1})]),default:o(()=>[e[12]||(e[12]=t(" 搜索 "))]),_:1}),u(a(f),{size:"large",bordered:"",onClick:e[6]||(e[6]=()=>{a(r).searchKeyWord=""})},{icon:o(()=>[u(a(g),null,{default:o(()=>[u(a(yu))]),_:1})]),default:o(()=>[e[13]||(e[13]=t(" 清空 "))]),_:1})]),_:1})]),_:1}),u(d,{loading:a(l).loading||a(F).loading,columns:a(Q),data:a(F).filterMergeDotBlackList,pagination:b},null,8,["loading","columns","data","pagination"]),u(P,{ref_key:"addAutoUIApp",ref:_,type:"add",title:"添加应用"},null,512),u(P,{ref_key:"updateAutoUIApp",ref:W,type:"update",title:"更新应用"},null,512)])}}});export{Ou as default};
